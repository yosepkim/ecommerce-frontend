{"ast":null,"code":"import React,{useEffect,useState}from'react';import{Link,useNavigate,useParams}from'react-router-dom';import{Button,Container,Form,FormGroup,Input,Label}from'reactstrap';import AppNavbar from'./AppNavbar';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProductDetail=()=>{const initialProduct={variations:[]};const initialOrder={status:\"NEW\",taxAmount:0.0,totalAmount:0.0,grandTotalAmount:0.0,lineItems:[]};const[product,setProduct]=useState(initialProduct);const[order,setOrder]=useState(initialOrder);const[loading,setLoading]=useState(true);const navigate=useNavigate();const{id}=useParams();let USDollar=new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'});useEffect(()=>{fetch(`/products/${id}`).then(response=>response.json()).then(data=>{setProduct(data);let lineItems=[];data.variations.map(productVariation=>{const lineItem={productVariation:productVariation,price:productVariation.price,quantity:0};lineItems.push(lineItem);});setOrder({...order,lineItems:lineItems});});setLoading(false);},[]);const handleChange=event=>{const{name,value}=event.target;const index=order.lineItems.findIndex(x=>x.productVariation.id===parseInt(name));order.lineItems[index].quantity=parseInt(value);let subTotal=0.0;order.lineItems.map(lineItem=>{const lineItemTotal=lineItem.quantity*lineItem.price;subTotal+=lineItemTotal;});order.totalAmount=subTotal;order.taxAmount=subTotal*0.07;order.grandTotalAmount=order.totalAmount+order.taxAmount;setOrder({...order});};const handleSubmit=async event=>{event.preventDefault();await fetch('/api/orders',{method:'POST',headers:{'Accept':'application/json','Content-Type':'application/json'},body:JSON.stringify(order)});setProduct(initialOrder);navigate('/order-confirmation');};if(loading){return/*#__PURE__*/_jsx(\"p\",{children:\"Loading...\"});}const productVariationList=product.variations.map(productVariation=>{return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{style:{whiteSpace:'nowrap'},children:productVariation.name}),/*#__PURE__*/_jsx(\"td\",{children:productVariation.description}),/*#__PURE__*/_jsxs(\"td\",{children:[\"$\",productVariation.price]}),/*#__PURE__*/_jsxs(\"td\",{children:[productVariation.inventory.onHandCount>0&&/*#__PURE__*/_jsx(Input,{type:\"text\",name:productVariation.id,id:productVariation.id,value:order.lineItems.find(x=>x.productVariation.id===productVariation.id).quantity||'0',onChange:handleChange}),productVariation.inventory.onHandCount<=0&&/*#__PURE__*/_jsx(\"span\",{children:\"Out of stock\"})]})]},productVariation.id);});return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(AppNavbar,{}),/*#__PURE__*/_jsx(\"div\",{class:\"mb-5\",children:\"\\xA0\"}),/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsx(Form,{onSubmit:handleSubmit,children:/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col text-center\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/api/images/\"+product.name+\"/image.png\"}),/*#__PURE__*/_jsx(\"h2\",{children:product.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col\",children:[/*#__PURE__*/_jsx(\"h4\",{children:product.description}),/*#__PURE__*/_jsxs(\"table\",{children:[productVariationList,/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsxs(\"td\",{colSpan:4,children:[/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(FormGroup,{children:[/*#__PURE__*/_jsxs(\"h5\",{children:[\"Sub total: \",USDollar.format(order.totalAmount)]}),/*#__PURE__*/_jsxs(\"h5\",{children:[\"Tax: \",USDollar.format(order.taxAmount)]}),/*#__PURE__*/_jsxs(\"h5\",{children:[\"Grand total: \",USDollar.format(order.grandTotalAmount)]}),/*#__PURE__*/_jsx(Button,{color:\"primary\",type:\"submit\",children:\"Buy\"}),' ',/*#__PURE__*/_jsx(Button,{color:\"secondary\",tag:Link,to:\"/products\",children:\"Cancel\"})]})]})})]})]})]})})})]});};export default ProductDetail;","map":{"version":3,"names":["React","useEffect","useState","Link","useNavigate","useParams","Button","Container","Form","FormGroup","Input","Label","AppNavbar","jsx","_jsx","jsxs","_jsxs","ProductDetail","initialProduct","variations","initialOrder","status","taxAmount","totalAmount","grandTotalAmount","lineItems","product","setProduct","order","setOrder","loading","setLoading","navigate","id","USDollar","Intl","NumberFormat","style","currency","fetch","then","response","json","data","map","productVariation","lineItem","price","quantity","push","handleChange","event","name","value","target","index","findIndex","x","parseInt","subTotal","lineItemTotal","handleSubmit","preventDefault","method","headers","body","JSON","stringify","children","productVariationList","whiteSpace","description","inventory","onHandCount","type","find","onChange","class","onSubmit","className","src","colSpan","format","color","tag","to"],"sources":["/Users/yoskim/workspace/workshop/boston/shop/app/src/ProductDetail.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Link, useNavigate, useParams } from 'react-router-dom';\nimport { Button, Container, Form, FormGroup, Input, Label } from 'reactstrap';\nimport AppNavbar from './AppNavbar';\n\nconst ProductDetail\n= () => {\n\n  const initialProduct = {\n    variations: []\n  };\n\n  const initialOrder = {\n      status: \"NEW\",\n      taxAmount: 0.0,\n      totalAmount: 0.0,\n      grandTotalAmount: 0.0,\n      lineItems: []\n  };\n\n  const [product, setProduct] = useState(initialProduct);\n  const [order, setOrder] = useState(initialOrder);\n  const [loading, setLoading] = useState(true);\n  const navigate = useNavigate();\n  const { id } = useParams();\n\n  let USDollar = new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD',\n  });\n\n  useEffect(() => {\n    fetch(`/products/${id}`)\n    .then(response => response.json())\n    .then(data => {\n       setProduct(data);\n       let lineItems = [];\n       data.variations.map(productVariation => {\n         const lineItem = {\n            productVariation: productVariation,\n            price: productVariation.price,\n            quantity: 0\n         }\n         lineItems.push(lineItem);\n       });\n       setOrder({ ...order, lineItems: lineItems });\n    });\n    setLoading(false);\n  }, []);\n\n  const handleChange = (event) => {\n    const { name, value } = event.target\n    const index = order.lineItems.findIndex(x => x.productVariation.id === parseInt(name));\n    order.lineItems[index].quantity = parseInt(value);\n\n    let subTotal = 0.0;\n    order.lineItems.map(lineItem => {\n        const lineItemTotal = lineItem.quantity * lineItem.price;\n        subTotal += lineItemTotal;\n    });\n\n    order.totalAmount = subTotal;\n    order.taxAmount = subTotal * 0.07;\n    order.grandTotalAmount = order.totalAmount + order.taxAmount;\n    setOrder({ ...order });\n  }\n\n  const handleSubmit = async (event) => {\n    event.preventDefault();\n\n    await fetch('/api/orders', {\n        method: 'POST',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(order)\n    });\n    setProduct(initialOrder);\n    navigate('/order-confirmation');\n  }\n\n  if (loading) {\n    return <p>Loading...</p>;\n  }\n\n  const productVariationList = product.variations.map(productVariation => {\n      return <tr key={productVariation.id}>\n        <td style={{whiteSpace: 'nowrap'}}>{productVariation.name}</td>\n        <td>{productVariation.description}</td>\n        <td>${productVariation.price}</td>\n        <td>\n            {\n              productVariation.inventory.onHandCount > 0 &&\n                <Input type=\"text\"\n                name={productVariation.id}\n                id={productVariation.id}\n                value={order.lineItems.find(x => x.productVariation.id === productVariation.id).quantity || '0'}\n                onChange={handleChange} />\n            }\n            {\n                productVariation.inventory.onHandCount <= 0 &&\n                <span>Out of stock</span>\n            }\n        </td>\n      </tr>\n    });\n\n  return (<div>\n      <AppNavbar/>\n      <div class=\"mb-5\">&nbsp;</div>\n      <Container>\n        <Form onSubmit={handleSubmit}>\n          <div className=\"row\">\n            <div className=\"col text-center\">\n                <img src={\"/api/images/\" + product.name + \"/image.png\"} />\n                <h2>{product.name}</h2>\n            </div>\n            <div className=\"col\">\n                <h4>{product.description}</h4>\n                <table>\n                    {productVariationList}\n                    <tr>\n                        <td colSpan={4}>\n                            <hr/>\n                            <FormGroup>\n                                <h5>Sub total: {USDollar.format(order.totalAmount)}</h5>\n                                <h5>Tax: {USDollar.format(order.taxAmount)}</h5>\n                                <h5>Grand total: {USDollar.format(order.grandTotalAmount)}</h5>\n                                <Button color=\"primary\" type=\"submit\">Buy</Button>{' '}\n                                <Button color=\"secondary\" tag={Link} to=\"/products\">Cancel</Button>\n                            </FormGroup>\n                        </td>\n                    </tr>\n                </table>\n            </div>\n          </div>\n        </Form>\n      </Container>\n    </div>\n  )\n};\n\nexport default ProductDetail;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,IAAI,CAAEC,WAAW,CAAEC,SAAS,KAAQ,kBAAkB,CAC/D,OAASC,MAAM,CAAEC,SAAS,CAAEC,IAAI,CAAEC,SAAS,CAAEC,KAAK,CAAEC,KAAK,KAAQ,YAAY,CAC7E,MAAO,CAAAC,SAAS,KAAM,aAAa,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEpC,KAAM,CAAAC,aAAa,CACjBA,CAAA,GAAM,CAEN,KAAM,CAAAC,cAAc,CAAG,CACrBC,UAAU,CAAE,EACd,CAAC,CAED,KAAM,CAAAC,YAAY,CAAG,CACjBC,MAAM,CAAE,KAAK,CACbC,SAAS,CAAE,GAAG,CACdC,WAAW,CAAE,GAAG,CAChBC,gBAAgB,CAAE,GAAG,CACrBC,SAAS,CAAE,EACf,CAAC,CAED,KAAM,CAACC,OAAO,CAAEC,UAAU,CAAC,CAAGzB,QAAQ,CAACgB,cAAc,CAAC,CACtD,KAAM,CAACU,KAAK,CAAEC,QAAQ,CAAC,CAAG3B,QAAQ,CAACkB,YAAY,CAAC,CAChD,KAAM,CAACU,OAAO,CAAEC,UAAU,CAAC,CAAG7B,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAAA8B,QAAQ,CAAG5B,WAAW,CAAC,CAAC,CAC9B,KAAM,CAAE6B,EAAG,CAAC,CAAG5B,SAAS,CAAC,CAAC,CAE1B,GAAI,CAAA6B,QAAQ,CAAG,GAAI,CAAAC,IAAI,CAACC,YAAY,CAAC,OAAO,CAAE,CAC1CC,KAAK,CAAE,UAAU,CACjBC,QAAQ,CAAE,KACd,CAAC,CAAC,CAEFrC,SAAS,CAAC,IAAM,CACdsC,KAAK,CAAC,aAAaN,EAAE,EAAE,CAAC,CACvBO,IAAI,CAACC,QAAQ,EAAIA,QAAQ,CAACC,IAAI,CAAC,CAAC,CAAC,CACjCF,IAAI,CAACG,IAAI,EAAI,CACXhB,UAAU,CAACgB,IAAI,CAAC,CAChB,GAAI,CAAAlB,SAAS,CAAG,EAAE,CAClBkB,IAAI,CAACxB,UAAU,CAACyB,GAAG,CAACC,gBAAgB,EAAI,CACtC,KAAM,CAAAC,QAAQ,CAAG,CACdD,gBAAgB,CAAEA,gBAAgB,CAClCE,KAAK,CAAEF,gBAAgB,CAACE,KAAK,CAC7BC,QAAQ,CAAE,CACb,CAAC,CACDvB,SAAS,CAACwB,IAAI,CAACH,QAAQ,CAAC,CAC1B,CAAC,CAAC,CACFjB,QAAQ,CAAC,CAAE,GAAGD,KAAK,CAAEH,SAAS,CAAEA,SAAU,CAAC,CAAC,CAC/C,CAAC,CAAC,CACFM,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAmB,YAAY,CAAIC,KAAK,EAAK,CAC9B,KAAM,CAAEC,IAAI,CAAEC,KAAM,CAAC,CAAGF,KAAK,CAACG,MAAM,CACpC,KAAM,CAAAC,KAAK,CAAG3B,KAAK,CAACH,SAAS,CAAC+B,SAAS,CAACC,CAAC,EAAIA,CAAC,CAACZ,gBAAgB,CAACZ,EAAE,GAAKyB,QAAQ,CAACN,IAAI,CAAC,CAAC,CACtFxB,KAAK,CAACH,SAAS,CAAC8B,KAAK,CAAC,CAACP,QAAQ,CAAGU,QAAQ,CAACL,KAAK,CAAC,CAEjD,GAAI,CAAAM,QAAQ,CAAG,GAAG,CAClB/B,KAAK,CAACH,SAAS,CAACmB,GAAG,CAACE,QAAQ,EAAI,CAC5B,KAAM,CAAAc,aAAa,CAAGd,QAAQ,CAACE,QAAQ,CAAGF,QAAQ,CAACC,KAAK,CACxDY,QAAQ,EAAIC,aAAa,CAC7B,CAAC,CAAC,CAEFhC,KAAK,CAACL,WAAW,CAAGoC,QAAQ,CAC5B/B,KAAK,CAACN,SAAS,CAAGqC,QAAQ,CAAG,IAAI,CACjC/B,KAAK,CAACJ,gBAAgB,CAAGI,KAAK,CAACL,WAAW,CAAGK,KAAK,CAACN,SAAS,CAC5DO,QAAQ,CAAC,CAAE,GAAGD,KAAM,CAAC,CAAC,CACxB,CAAC,CAED,KAAM,CAAAiC,YAAY,CAAG,KAAO,CAAAV,KAAK,EAAK,CACpCA,KAAK,CAACW,cAAc,CAAC,CAAC,CAEtB,KAAM,CAAAvB,KAAK,CAAC,aAAa,CAAE,CACvBwB,MAAM,CAAE,MAAM,CACdC,OAAO,CAAE,CACP,QAAQ,CAAE,kBAAkB,CAC5B,cAAc,CAAE,kBACpB,CAAC,CACDC,IAAI,CAAEC,IAAI,CAACC,SAAS,CAACvC,KAAK,CAC5B,CAAC,CAAC,CACFD,UAAU,CAACP,YAAY,CAAC,CACxBY,QAAQ,CAAC,qBAAqB,CAAC,CACjC,CAAC,CAED,GAAIF,OAAO,CAAE,CACX,mBAAOhB,IAAA,MAAAsD,QAAA,CAAG,YAAU,CAAG,CAAC,CAC1B,CAEA,KAAM,CAAAC,oBAAoB,CAAG3C,OAAO,CAACP,UAAU,CAACyB,GAAG,CAACC,gBAAgB,EAAI,CACpE,mBAAO7B,KAAA,OAAAoD,QAAA,eACLtD,IAAA,OAAIuB,KAAK,CAAE,CAACiC,UAAU,CAAE,QAAQ,CAAE,CAAAF,QAAA,CAAEvB,gBAAgB,CAACO,IAAI,CAAK,CAAC,cAC/DtC,IAAA,OAAAsD,QAAA,CAAKvB,gBAAgB,CAAC0B,WAAW,CAAK,CAAC,cACvCvD,KAAA,OAAAoD,QAAA,EAAI,GAAC,CAACvB,gBAAgB,CAACE,KAAK,EAAK,CAAC,cAClC/B,KAAA,OAAAoD,QAAA,EAEMvB,gBAAgB,CAAC2B,SAAS,CAACC,WAAW,CAAG,CAAC,eACxC3D,IAAA,CAACJ,KAAK,EAACgE,IAAI,CAAC,MAAM,CAClBtB,IAAI,CAAEP,gBAAgB,CAACZ,EAAG,CAC1BA,EAAE,CAAEY,gBAAgB,CAACZ,EAAG,CACxBoB,KAAK,CAAEzB,KAAK,CAACH,SAAS,CAACkD,IAAI,CAAClB,CAAC,EAAIA,CAAC,CAACZ,gBAAgB,CAACZ,EAAE,GAAKY,gBAAgB,CAACZ,EAAE,CAAC,CAACe,QAAQ,EAAI,GAAI,CAChG4B,QAAQ,CAAE1B,YAAa,CAAE,CAAC,CAG1BL,gBAAgB,CAAC2B,SAAS,CAACC,WAAW,EAAI,CAAC,eAC3C3D,IAAA,SAAAsD,QAAA,CAAM,cAAY,CAAM,CAAC,EAE7B,CAAC,GAjBSvB,gBAAgB,CAACZ,EAkB7B,CAAC,CACP,CAAC,CAAC,CAEJ,mBAAQjB,KAAA,QAAAoD,QAAA,eACJtD,IAAA,CAACF,SAAS,GAAC,CAAC,cACZE,IAAA,QAAK+D,KAAK,CAAC,MAAM,CAAAT,QAAA,CAAC,MAAM,CAAK,CAAC,cAC9BtD,IAAA,CAACP,SAAS,EAAA6D,QAAA,cACRtD,IAAA,CAACN,IAAI,EAACsE,QAAQ,CAAEjB,YAAa,CAAAO,QAAA,cAC3BpD,KAAA,QAAK+D,SAAS,CAAC,KAAK,CAAAX,QAAA,eAClBpD,KAAA,QAAK+D,SAAS,CAAC,iBAAiB,CAAAX,QAAA,eAC5BtD,IAAA,QAAKkE,GAAG,CAAE,cAAc,CAAGtD,OAAO,CAAC0B,IAAI,CAAG,YAAa,CAAE,CAAC,cAC1DtC,IAAA,OAAAsD,QAAA,CAAK1C,OAAO,CAAC0B,IAAI,CAAK,CAAC,EACtB,CAAC,cACNpC,KAAA,QAAK+D,SAAS,CAAC,KAAK,CAAAX,QAAA,eAChBtD,IAAA,OAAAsD,QAAA,CAAK1C,OAAO,CAAC6C,WAAW,CAAK,CAAC,cAC9BvD,KAAA,UAAAoD,QAAA,EACKC,oBAAoB,cACrBvD,IAAA,OAAAsD,QAAA,cACIpD,KAAA,OAAIiE,OAAO,CAAE,CAAE,CAAAb,QAAA,eACXtD,IAAA,QAAI,CAAC,cACLE,KAAA,CAACP,SAAS,EAAA2D,QAAA,eACNpD,KAAA,OAAAoD,QAAA,EAAI,aAAW,CAAClC,QAAQ,CAACgD,MAAM,CAACtD,KAAK,CAACL,WAAW,CAAC,EAAK,CAAC,cACxDP,KAAA,OAAAoD,QAAA,EAAI,OAAK,CAAClC,QAAQ,CAACgD,MAAM,CAACtD,KAAK,CAACN,SAAS,CAAC,EAAK,CAAC,cAChDN,KAAA,OAAAoD,QAAA,EAAI,eAAa,CAAClC,QAAQ,CAACgD,MAAM,CAACtD,KAAK,CAACJ,gBAAgB,CAAC,EAAK,CAAC,cAC/DV,IAAA,CAACR,MAAM,EAAC6E,KAAK,CAAC,SAAS,CAACT,IAAI,CAAC,QAAQ,CAAAN,QAAA,CAAC,KAAG,CAAQ,CAAC,CAAC,GAAG,cACtDtD,IAAA,CAACR,MAAM,EAAC6E,KAAK,CAAC,WAAW,CAACC,GAAG,CAAEjF,IAAK,CAACkF,EAAE,CAAC,WAAW,CAAAjB,QAAA,CAAC,QAAM,CAAQ,CAAC,EAC5D,CAAC,EACZ,CAAC,CACL,CAAC,EACF,CAAC,EACP,CAAC,EACH,CAAC,CACF,CAAC,CACE,CAAC,EACT,CAAC,CAEV,CAAC,CAED,cAAe,CAAAnD,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}